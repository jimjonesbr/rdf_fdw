SELECT sparql.add_context('testctx', 'test context');
 add_context 
-------------
 
(1 row)

SELECT sparql.add_prefix('testctx', 'rdf', 'http://www.w3.org/2000/01/rdf-schema#');
 add_prefix 
------------
 
(1 row)

CREATE SERVER graphdb
FOREIGN DATA WRAPPER rdf_fdw 
OPTIONS (
  endpoint   'http://graphdb:7200/repositories/test/statements', -- this tests if the regular endpoint is used for updates
  prefix_context 'testctx',
  batch_size '5'); 
CREATE USER MAPPING FOR postgres
SERVER graphdb OPTIONS (user 'admin', password 'secret');
CREATE FOREIGN TABLE ft (
  subject   rdfnode OPTIONS (variable '?s'),
  predicate rdfnode OPTIONS (variable '?p'),
  foo       rdfnode OPTIONS (variable '?foo'), -- will be ignored
  object    rdfnode OPTIONS (variable '?o') 
)
SERVER graphdb OPTIONS (
  log_sparql 'false',
  sparql 'SELECT * {?s ?p ?o}',
  sparql_update_pattern 
    '?s ?p ?o .
     ?s rdf:comment "added via rdf_fdw üêò"^^<http://www.w3.org/2001/XMLSchema#string>.'
  );
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University'),
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', ''),
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', '""'),
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', '""@es'),
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', '"University of M√ºnster"@en'),
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', '"Westf√§lische \"Wilhelms-Universit√§t\" M√ºnster"@de'),
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', '"Westf√§lische \nWilhelms-Universit√§t\n M√ºnster"@de'),
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', '"Westf√§lische .. Wilhelms-Universit√§t . M√ºnster"@de'),
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#seeAlso>', 'üêò'::rdfnode);
/* Set the endpoint to the right URL and add update_url */
ALTER SERVER graphdb OPTIONS (ADD update_url 'http://graphdb:7200/repositories/test/statements',
                              SET endpoint 'http://graphdb:7200/repositories/test');
SELECT subject, predicate, object FROM ft
WHERE subject = '<https://www.uni-muenster.de>'
ORDER BY predicate, object::text COLLATE "C";
            subject            |                      predicate                       |                       object                        
-------------------------------+------------------------------------------------------+-----------------------------------------------------
 <https://www.uni-muenster.de> | <http://www.w3.org/1999/02/22-rdf-syntax-ns#seeAlso> | "üêò"
 <https://www.uni-muenster.de> | <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>    | "http://dbpedia.org/resource/University"
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#comment>       | "added via rdf_fdw üêò"
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#label>         | ""
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#label>         | ""@es
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#label>         | "University of M√ºnster"@en
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#label>         | "Westf√§lische                                      +
                               |                                                      | Wilhelms-Universit√§t                               +
                               |                                                      |  M√ºnster"@de
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#label>         | "Westf√§lische .. Wilhelms-Universit√§t . M√ºnster"@de
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#label>         | "Westf√§lische \"Wilhelms-Universit√§t\" M√ºnster"@de
(9 rows)

/* Test DEFAULT values handling */
ALTER FOREIGN TABLE ft ALTER COLUMN object SET DEFAULT '"default literal"'::rdfnode;
INSERT INTO ft (subject, predicate) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#altLabel>');
SELECT subject, predicate, object FROM ft 
WHERE predicate = '<http://www.w3.org/2000/01/rdf-schema#altLabel>';
            subject            |                    predicate                    |      object       
-------------------------------+-------------------------------------------------+-------------------
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#altLabel> | "default literal"
(1 row)

ALTER FOREIGN TABLE ft ALTER COLUMN object DROP DEFAULT;
/* insert large literal */
ALTER FOREIGN TABLE ft OPTIONS (SET log_sparql 'false'); -- disable logging to not flood the ouput file
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#altLabel>', repeat('b', 1000000)::rdfnode);
SELECT subject, predicate, sparql.strlen(object)
FROM ft WHERE predicate = '<http://www.w3.org/2000/01/rdf-schema#altLabel>';
            subject            |                    predicate                    | strlen  
-------------------------------+-------------------------------------------------+---------
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#altLabel> |      15
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#altLabel> | 1000000
(2 rows)

/* bulk insert */
INSERT INTO ft (subject, predicate, object)
SELECT
  sparql.iri('https://www.uni-muenster.de'),
  sparql.iri('http://www.w3.org/1999/02/22-rdf-syntax-ns#value'),
  i::rdfnode
FROM generate_series(1,100) AS j (i);
SELECT count(*) FROM ft;
 count 
-------
   190
(1 row)

/* insert with RETURNING */
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/2000/01/rdf-schema#label>', '"Universidade de M√ºnster"@pt')
RETURNING *;
            subject            |                  predicate                   | foo |            object            
-------------------------------+----------------------------------------------+-----+------------------------------
 <https://www.uni-muenster.de> | <http://www.w3.org/2000/01/rdf-schema#label> |     | "Universidade de M√ºnster"@pt
(1 row)

/* 
 * Here we transfer data from Wikidata to graphdb. 
 * The NAMED GRAPH is manually specified in the sparql
 * and sparql_update_pattern options. graphdb will then
 * create the graph in query time, if it does not exist.
 */
CREATE SERVER wikidata
FOREIGN DATA WRAPPER rdf_fdw 
OPTIONS (
  endpoint 'https://query.wikidata.org/sparql');
CREATE FOREIGN TABLE rdbms_wikidata (
  s rdfnode OPTIONS (variable '?s'),
  p rdfnode OPTIONS (variable '?p'),
  o rdfnode OPTIONS (variable '?o')
)
SERVER wikidata OPTIONS (
  log_sparql 'false',
  sparql $$
    SELECT * {?s ?p ?o .
    FILTER(?s=<http://www.wikidata.org/entity/Q192490>)
    FILTER(?p=<http://www.w3.org/2004/02/skos/core#altLabel>)}
  $$
  );
CREATE FOREIGN TABLE rdbms_graphdb (
  s rdfnode OPTIONS (variable '?s'),
  p rdfnode OPTIONS (variable '?p'),
  o rdfnode OPTIONS (variable '?o')
)
SERVER graphdb OPTIONS (
  log_sparql 'true',
  sparql $$
    SELECT * {
      GRAPH <http://www.uni-muenster.de/graph> {
        ?s ?p ?o .    
      FILTER(?s=<http://www.wikidata.org/entity/Q192490>)
      FILTER(?p=<http://www.w3.org/2004/02/skos/core#altLabel>)
      }
    }
    $$,
  sparql_update_pattern $$
    GRAPH <http://www.uni-muenster.de/graph> {
      ?s ?p ?o .
    }
  $$);
INSERT INTO rdbms_graphdb (s, p, o)
SELECT s, p, o FROM rdbms_wikidata;
INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL"@ar .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ú‡¶ø‡¶Ü‡¶∞‡¶á"@bn .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@ca .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@de .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL project"@de .
    } };


INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@en .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Ÿæÿ≥ÿ™ ⁄Øÿ± ÿßÿ≥ ⁄©€åŸàÿßŸÑ"@fa .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Ÿæÿ≥ÿ™⁄Øÿ± ÿßÿ≥⁄©€åŸàÿßŸÑ"@fa .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@fr .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@hu .
    } };


INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@it .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@ja .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "„Éù„Çπ„Ç∞„É¨"@ja .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "„Éù„Çπ„Éà„Ç∞„É¨„Çπ„Ç≠„É•„Éº„Ç®„É´"@ja .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@lv .
    } };


INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@mul .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "postgres"@nl .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PgSQL"@pl .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgre"@pl .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@pl .
    } };


INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@pt .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "pgsql"@pt-br .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgre"@sr .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgre SQL"@sr .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@sr .
    } };


INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgresql"@sr .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL, —Å–ª–æ–±–æ–¥–Ω–∏ —Å–æ—Ñ—Ç–≤–µ—Ä"@sr .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@sv .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "‡Æ™‡Øã‡Æö‡ØÅ‡Æï‡Æø‡Æ∞‡Æö‡ØÅ"@ta .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL"@th .
    } };


INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏Å‡∏£‡∏™"@th .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "POSTGRE SQL"@vi .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@zh .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@zh-hant .
    } };
INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@zh-tw .
    } };


INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

INSERT DATA { 
    GRAPH <http://www.uni-muenster.de/graph> {
      <http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PG"@zh-cn .
    } };


SELECT * FROM rdbms_graphdb 
ORDER BY o::text COLLATE "C";
INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?s ?p ?o 
{
      GRAPH <http://www.uni-muenster.de/graph> {
        ?s ?p ?o .    
      FILTER(?s=<http://www.wikidata.org/entity/Q192490>)
      FILTER(?p=<http://www.w3.org/2004/02/skos/core#altLabel>)
      }
    }

INFO:  SPARQL returned 36 records.

                    s                     |                       p                        |                 o                 
------------------------------------------+------------------------------------------------+-----------------------------------
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "PG"@zh-CN
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "POSTGRE SQL"@vi
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "PgSQL"@pl
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgre SQL"@sr
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgre"@pl
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgre"@sr
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "PostgreSQL project"@de
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "PostgreSQL"@ar
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "PostgreSQL"@th
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "PostgreSQL, —Å–ª–æ–±–æ–¥–Ω–∏ —Å–æ—Ñ—Ç–≤–µ—Ä"@sr
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@ca
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@de
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@en
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@fr
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@hu
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@it
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@ja
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@lv
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@mul
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@pl
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@pt
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@sr
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@sv
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@zh
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@zh-Hant
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgres"@zh-TW
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Postgresql"@sr
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "pgsql"@pt-BR
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "postgres"@nl
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Ÿæÿ≥ÿ™ ⁄Øÿ± ÿßÿ≥ ⁄©€åŸàÿßŸÑ"@fa
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "Ÿæÿ≥ÿ™⁄Øÿ± ÿßÿ≥⁄©€åŸàÿßŸÑ"@fa
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ú‡¶ø‡¶Ü‡¶∞‡¶á"@bn
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "‡Æ™‡Øã‡Æö‡ØÅ‡Æï‡Æø‡Æ∞‡Æö‡ØÅ"@ta
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏Å‡∏£‡∏™"@th
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "„Éù„Çπ„Ç∞„É¨"@ja
 <http://www.wikidata.org/entity/Q192490> | <http://www.w3.org/2004/02/skos/core#altLabel> | "„Éù„Çπ„Éà„Ç∞„É¨„Çπ„Ç≠„É•„Éº„Ç®„É´"@ja
(36 rows)

COPY (
  SELECT s, p , o
  FROM rdbms_graphdb 
  ORDER BY o::text COLLATE "C"
) TO STDOUT DELIMITER E' ';
INFO:  SPARQL query sent to 'graphdb':
PREFIX rdf: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?s ?p ?o 
{
      GRAPH <http://www.uni-muenster.de/graph> {
        ?s ?p ?o .    
      FILTER(?s=<http://www.wikidata.org/entity/Q192490>)
      FILTER(?p=<http://www.w3.org/2004/02/skos/core#altLabel>)
      }
    }

INFO:  SPARQL returned 36 records.

<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PG"@zh-CN
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "POSTGRE\ SQL"@vi
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PgSQL"@pl
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgre\ SQL"@sr
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgre"@pl
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgre"@sr
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL\ project"@de
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL"@ar
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL"@th
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "PostgreSQL,\ —Å–ª–æ–±–æ–¥–Ω–∏\ —Å–æ—Ñ—Ç–≤–µ—Ä"@sr
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@ca
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@de
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@en
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@fr
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@hu
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@it
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@ja
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@lv
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@mul
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@pl
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@pt
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@sr
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@sv
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@zh
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@zh-Hant
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgres"@zh-TW
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Postgresql"@sr
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "pgsql"@pt-BR
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "postgres"@nl
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Ÿæÿ≥ÿ™\ ⁄Øÿ±\ ÿßÿ≥\ ⁄©€åŸàÿßŸÑ"@fa
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "Ÿæÿ≥ÿ™⁄Øÿ±\ ÿßÿ≥⁄©€åŸàÿßŸÑ"@fa
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ú‡¶ø‡¶Ü‡¶∞‡¶á"@bn
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "‡Æ™‡Øã‡Æö‡ØÅ‡Æï‡Æø‡Æ∞‡Æö‡ØÅ"@ta
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏Å‡∏£‡∏™"@th
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "„Éù„Çπ„Ç∞„É¨"@ja
<http://www.wikidata.org/entity/Q192490> <http://www.w3.org/2004/02/skos/core#altLabel> "„Éù„Çπ„Éà„Ç∞„É¨„Çπ„Ç≠„É•„Éº„Ç®„É´"@ja
/*** Exception tests ***/
/* COPY .. FROM must fail - not supported */
COPY ft (subject, predicate, object) FROM STDIN WITH (DELIMITER ' ');
ERROR:  COPY FROM is not supported by rdf_fdw
/* INSERT must fail - all columns must be of type rdfnode */
ALTER FOREIGN TABLE ft ALTER COLUMN predicate TYPE text;
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  rdfExecForeignInsert: column 'predicate' is not of type rdfnode
ALTER FOREIGN TABLE ft ALTER COLUMN predicate TYPE rdfnode;
/* INSERT must fail - no column with the variable ?p */
ALTER FOREIGN TABLE ft ALTER COLUMN predicate OPTIONS (SET variable '?bar');
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  SPARQL variable '?p' in 'sparql_update_pattern' is not mapped to any table column
/* ALTER COLUMN must fail - variable is required */
ALTER FOREIGN TABLE ft ALTER COLUMN predicate OPTIONS (DROP variable);
ERROR:  required option 'variable' is missing
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  SPARQL variable '?p' in 'sparql_update_pattern' is not mapped to any table column
\set VERBOSITY terse
/* invalid sparql_update_pattern - no triple pattern */
ALTER FOREIGN TABLE ft ALTER COLUMN predicate OPTIONS (SET variable '?p');
ALTER FOREIGN TABLE ft OPTIONS (SET sparql_update_pattern '?s ?o .');
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  'sparql_update_pattern' contains no valid triple patterns
/* invalid sparql_update_pattern - no variable */
ALTER FOREIGN TABLE ft OPTIONS (SET sparql_update_pattern 'foo .');
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  'sparql_update_pattern' contains no valid triple patterns
/* invalid update_url - no URL */
ALTER FOREIGN TABLE ft OPTIONS (SET sparql_update_pattern '?s ?p o .');
ALTER SERVER graphdb OPTIONS (SET update_url 'foo');
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  invalid update_url: 'foo'
/* invalid triple pattern - no sparql_update_pattern OPTION */
ALTER SERVER graphdb OPTIONS (SET update_url 'http://graphdb:7200/repositories/test/statements',
                             SET endpoint 'http://graphdb:7200/repositories/test');
ALTER FOREIGN TABLE ft OPTIONS (DROP sparql_update_pattern);
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  INSERT operation requires a valid triple pattern in 'sparql_update_pattern'
/* invalid triple pattern - empty sparql_update_pattern OPTION */
ALTER FOREIGN TABLE ft OPTIONS (ADD sparql_update_pattern ' ');
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'http://dbpedia.org/resource/University');
ERROR:  'sparql_update_pattern' contains no valid triple patterns
/* invalid value - NULL value */
ALTER FOREIGN TABLE ft OPTIONS (SET sparql_update_pattern '?s ?p ?o .');
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', NULL);
ERROR:  NULL value in column "object" violates RDF constraint
/* invalid value - blank node */
INSERT INTO ft (subject, predicate, object) VALUES
('<https://www.uni-muenster.de>', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', sparql.bnode());
ERROR:  blank nodes are not allowed in INSERT operations
/* cleanup */
DELETE FROM ft;
SELECT sparql.drop_context('testctx', true);
 drop_context 
--------------
 
(1 row)

DROP SERVER graphdb CASCADE;
NOTICE:  drop cascades to 3 other objects
DROP SERVER wikidata CASCADE;
NOTICE:  drop cascades to foreign table rdbms_wikidata
